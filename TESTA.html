<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="1024" height="768" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");

rect1=(ctx,x,y,w,h,c="red",r=5,a=0)=>{
    ctx.save()
    ctx.fillStyle=c
    ctx.beginPath()
    ctx.miterLimit=30
    ctx.lineWidth=2
    ctx.moveTo(x, y)
    ctx.lineTo(x+w, y)
    ctx.arcTo(x+w+r, y, x+w+r, y+r, r)
    ctx.lineTo(x+w+r,y+h+r)
    ctx.arcTo(x+w+r,y+h+r+r,x+w,y+h+r+r,r)
    ctx.lineTo(x,y+h+r+r)
    ctx.arcTo(x-r,y+h+r+r,x-r,y+h+r,r)
    ctx.lineTo(x-r,y+r)
    ctx.arcTo(x-r,y,x,y,r)
    if(a){
     ctx.fill()
    }else{
     ctx.stroke()
    }
    // for(var i=0;i<(x+w)/5+(y+r+h)/5;i++){

    // }
    ctx.restore()
}
let bar1 = {
	x:20,
    y:20,
    h:50,
    life:100,
    ml:100
}
let bar2 = {
	x:60,
    y:20,
    h:50,
    life:100,
    ml:100
}
bar=(x,y,h,live,ml)=>{
	let cy = h/ml*live
	let ty=y
    rect1(ctx,x,y+=(h-cy),5,cy,"#ccc",5,1)
    rect1(ctx,x,ty,5,h,"#000")
 	for(var i=0;i<=live;i+=20){
    	rect1(ctx,x,ty+(h-h/ml*i),8,1,"#aa1",1,1)
    }
    ctx.font="20px Impact"
    ctx.fillText("❤️",x-10,ty+h+10*2)
}

let a =[[,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,5,6,6,5,6,5,6,5,6,5,6,5,6,6,5,6,5,6,5,6,6,5,6,5,6,5,6],[6,6,5,6,6,6,5,5,5,7,6,7,7,5,6,5,5,5,5,5,6,6,5,5,7,5,6,6],[6,5,5,7,7,6,5,5,7,7,6,6,6,6,6,5,5,6,6,6,6,6,6,7,5,5,5,6],[6,6,6,7,5,6,5,7,7,6,6,6,6,6,6,6,5,5,5,5,6,5,6,6,5,5,6,6],[6,6,6,5,5,6,6,6,5,7,5,5,5,6,5,5,6,6,6,6,5,5,5,5,6,5,6,6],[6,6,6,5,5,5,5,6,6,5,5,6,5,5,5,5,5,5,6,6,6,5,5,6,6,5,6,6],[6,6,6,6,6,6,6,5,6,6,5,5,5,5,5,5,5,6,5,5,6,6,5,5,5,7,6,6],[6,6,6,6,5,5,6,6,6,5,6,6,5,5,6,5,6,6,5,5,5,6,6,5,5,7,6,6],[6,6,7,6,6,5,5,5,5,6,6,6,5,5,5,6,6,5,5,5,5,6,5,5,7,6,5,6],[6,5,5,7,6,6,5,5,5,7,5,6,6,6,5,6,5,5,5,6,6,6,5,5,5,6,6,6],[6,6,5,5,5,6,6,6,5,7,5,5,5,5,5,7,5,7,7,5,5,6,5,5,6,5,6,6],[6,5,5,5,5,5,6,6,7,5,5,5,5,5,7,5,5,6,6,5,5,5,6,6,5,6,6,6],[6,6,5,5,5,5,6,5,6,5,5,5,5,5,7,5,5,5,6,6,6,6,6,6,5,5,5,6],[6,5,7,5,5,5,6,5,6,6,5,6,5,6,7,5,6,6,6,6,6,6,5,6,5,5,6,6],[6,6,7,5,5,6,6,5,5,6,6,5,5,6,7,5,5,6,6,6,6,6,5,6,5,5,5,6],[6,5,7,5,6,5,5,5,5,5,6,5,5,7,6,5,6,5,6,6,6,7,6,6,5,5,6,6],[6,6,5,5,5,5,5,6,6,5,5,5,5,5,6,6,5,6,5,5,5,6,6,5,5,5,5,6],[6,5,5,5,5,5,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,5,6,6],[6,6,5,5,5,6,5,7,6,6,7,7,5,5,5,6,5,6,5,5,6,5,5,5,5,7,6,6],[6,5,5,5,6,6,5,6,6,7,7,5,7,5,5,6,5,6,5,7,6,5,5,5,7,6,6,6],[6,6,6,6,6,5,6,6,6,5,5,5,5,5,5,6,5,5,6,5,6,5,5,5,7,6,6,6],[6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,6,6,6,6,6,6,7,5,5,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,6,6,5,6,6,6,6,6,7,5,6,6],[6,6,5,6,6,6,6,6,6,6,6,5,5,5,6,6,6,5,5,5,5,6,6,6,6,5,6,6],[6,6,6,6,6,6,6,5,5,7,6,6,5,5,6,5,5,5,5,5,5,6,6,5,5,6,5,6],[6,6,6,6,6,6,6,6,6,6,6,6,5,6,6,5,6,6,5,6,6,6,6,6,6,6,6,6],[,6,6,6,6,6,6,6,6,6,5,6,6,6,6,6,5,6,6,6,6,6,6,6,6,6,6]]
//[[,,,,,,,,,,,,6],[,,,,,,,,,,,6,2,6],[,,,,,,,,,,6,7,2,2,6],[,,,,,,,,,,6,7,7,1,6,,,,,6,6],[,,,6,6,6,,,,,6,7,7,1,6,,,,6,2,2,6],[,,,6,2,2,6,,,,6,7,7,1,6,,,6,7,1,2,6],[,,,6,7,2,2,6,,,6,7,7,1,6,,6,7,7,1,6],[,,,,6,7,7,1,6,,6,7,7,1,6,6,7,7,1,6],[,,,,,6,7,7,1,6,6,5,5,5,5,7,7,1,6],[,,,,,,6,7,1,7,5,5,5,5,5,5,1,6],[,,,,,,,6,2,5,5,5,6,6,5,5,5,2],[,,6,6,6,6,6,6,5,5,5,6,6,6,6,5,5,5,6,6,6,6,6,6],[,6,2,1,1,1,1,1,5,5,6,7,6,7,6,6,5,5,7,7,7,7,7,7,6],[6,2,2,7,7,7,7,7,5,5,6,6,7,6,6,6,5,5,7,7,7,7,7,2,2,6],[,6,7,7,7,7,7,7,5,5,5,7,6,7,6,5,5,5,1,1,1,1,1,2,6],[,,6,6,6,6,6,6,6,5,5,5,6,6,5,5,5,2,6,6,6,6,6,6],[,,,,,,,6,1,7,5,5,5,5,5,5,7,6],[,,,,,,6,1,7,7,6,5,5,5,5,7,7,7,6],[,,,,,6,1,1,7,6,6,1,7,7,6,6,1,1,7,6],[,,,,6,1,7,7,6,,6,1,7,7,6,,6,1,7,7,6],[,,,6,2,2,7,6,,,6,1,7,7,6,,,6,1,7,7,6],[,,,6,2,7,6,,,,6,1,7,7,6,,,,6,1,2,7,6],[,,,6,6,6,,,,,6,1,7,7,6,,,,,6,2,2,6],[,,,,,,,,,,6,2,2,7,6,,,,,,6,6,6],[,,,,,,,,,,,6,2,6],[,,,,,,,,,,,,6]]
//[[,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,4,4,4,4,3,4,4,4,3,3,3],[3,3,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,3,3,4,4,3,4,3,3],[3,3,4,4,4,4,4,4,3,4,4,4,3,3,4,4,4,4,4,3,4,4,3,3,3,4,3,3],[3,3,4,4,4,3,4,4,4,4,4,3,3,4,4,4,4,3,3,4,4,3,3,4,4,4,3,3],[3,3,4,4,4,4,4,4,4,4,3,3,4,4,4,4,3,3,4,4,3,4,4,4,4,4,3,3],[3,3,4,4,4,4,4,3,4,3,3,4,4,4,4,3,3,4,4,3,4,4,4,4,4,4,3,3],[3,3,4,4,4,4,4,3,3,4,4,4,4,4,3,3,4,4,3,4,4,4,4,3,4,4,3,3],[3,3,4,4,4,4,4,3,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,3,3],[3,3,3,3,3,3,3,3,4,4,4,4,3,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3],[3,3,3,4,4,4,4,4,4,4,3,3,4,4,4,4,4,4,4,4,4,3,4,4,4,4,3,3],[3,3,4,4,4,4,4,4,4,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3],[3,3,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,3,3],[3,3,4,4,4,4,3,3,4,4,4,3,3,4,4,4,4,4,4,4,4,3,4,4,4,3,3,3],[3,3,4,4,4,3,3,4,4,4,3,3,4,4,4,4,4,4,4,3,3,4,4,4,4,3,3,3],[3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,4,4,3,3,3,3],[3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,4,4,3,4,4,3,3],[3,3,4,4,4,4,4,4,3,3,4,3,4,4,4,4,4,3,3,4,4,3,3,3,4,4,3,3],[3,3,4,4,4,4,4,3,3,4,3,4,4,4,4,4,3,3,4,4,4,3,4,4,4,4,3,3],[3,3,4,4,4,4,4,3,4,3,3,4,4,4,3,3,3,4,4,4,4,3,4,4,4,4,3,3],[3,3,4,4,4,4,3,3,4,4,4,4,4,3,4,4,4,4,4,4,3,3,4,4,4,4,3,3],[3,3,4,4,4,3,4,4,4,4,4,4,3,3,4,4,4,4,3,3,3,4,4,4,4,4,3,3],[3,3,4,4,3,3,4,4,4,4,4,3,3,4,4,4,4,3,3,3,4,4,4,4,4,4,3,3],[3,3,4,3,4,4,4,4,4,3,3,3,4,4,4,4,3,4,4,4,4,4,4,4,4,4,3,3],[3,3,3,4,4,4,4,4,3,3,4,4,4,4,4,3,3,4,4,4,4,4,4,4,4,4,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]]
createWall=a=>{
let ColorPlatte= [
  "f77097",
  "c7b09e",
  "f4f4fb",
  "B08968",
  "8e3d10",
  "234841",
  "041915",
  "53788c",
  "2ce8f5",
  "1B4965"
]
var sx = 9
var b = document.createElement('canvas')
var c1 = b.getContext('2d',{
    alpha: false,
    desynchronized: true
})

var w=28*sx
var h=28*sx
b.width = w,b.height = h
  var LL=RR=0,stroke=0
  var LW = LL?w:0,RH=RR?h:0
  var L= LW?minus:1,R=RH?minus:1
  var haw = w/2,hah = h/2
  for(var i=0,h1=0;i<a.length;i++,h1+=sx){
    for(var j = 0,w1=0;j<a[i].length;j++,w1+=sx){
        var color =a[i][j]
        if (color!=null){
          c1.fillStyle = "#"+ColorPlatte[color]
          c1.fillRect(w1,h1,sx,sx)
          stroke?c1.strokeRect(w1,h1,sx,sx):0
        }
    }
  }
  var imagea = new Image();
  imagea.src = b.toDataURL();
  return imagea;
}
let wall = createWall(a)
let GameObject=[]
let testWall = {
    x:1024/6,
    y:381,
    z:256,
    wh:256
}
let centerX = 1024/2
let centerY = 768/2
Rand=a=>Math.random()*a
RandInt=a=>Rand(a)|0;
RandIntBetween=(a,b)=>a+RandInt(b-a+1);

// draw cloud
const drawCloud = (x, y,wx,wy) => {
    ctx.beginPath();
    ctx.arc(x, y, 60, Math.PI * 0.5, Math.PI * 1.5);
    ctx.arc(x + 70, y - 60, 70, Math.PI * 1, Math.PI * 1.85);
    ctx.arc(x + 152, y - 45, 50, Math.PI * 1.37, Math.PI * 1.91);
    ctx.arc(x + 200, y, 60, Math.PI * 1.5, Math.PI * 0.5);
    ctx.moveTo(x + 200, y + 60);
    ctx.lineTo(x, y + 60);
    /* think to modify */
    ctx.arc(x + 300, y, 60, Math.PI * 1.5, Math.PI * 0.5);
    ctx.arc(x + 400, y, 60, Math.PI * 1.5, Math.PI * 0.5);
    
    ctx.strokeStyle = '#797874';
    ctx.stroke();
    ctx.fillStyle = '#8ED6FF';
    ctx.fill()
}

for (let i = 0; i < 32; i++) {
    GameObject.push({
        x:32*i,
        y:768,
        z:256,
        wh:256
    })
}
// math z-index
/*

    e.x += (centerX-e.x)/e.z
    e.y -= (centerY-0)/e.z
    e.z -= ms * duration
     ------------------------
    |close   >>>>>>> far     |
    |lighter >>>>>>> dark    |
     ------------------------
    globalAlpha = 1 - (e.wh/e.z)

*/
/*Draw background map >>
        
        let pr = e.z/5
        // e.x += (e.x-centerX)*(e.wh/e.z)
        e.x += (centerX-e.x)/e.z
        e.y -= (centerY-0)/e.z
        e.z-=.5
        e.z=Math.max(e.z,0)
        rect1(ctx,e.x,e.y,pr,pr,"#0a0",1,1)
        ctx.save()
        ctx.fillStyle="#888"
        ctx.globalAlpha=1-(e.z/e.wh)
        ctx.fillRect(e.x,e.y,pr,pr)
        //ctx.fillRect(100,e.y,pr,pr)
        ctx.restore()

*/
let colorAlpha={
    z:1
}
// linear 
function bounce(timeFraction) {
    for (let a = 0, b = 1; 1; a += b, b /= 2) {
        if (timeFraction >= (7 - 4 * a) / 11) {
          return -Math.pow((11 - 6 * a - 11 * timeFraction) / 4, 2) + Math.pow(b, 2)
        }
    }
}
blink=ms=>{
    var w=h=1024
    // var radialGradient = ctx.createRadialGradient(0,0, 40, w, h, 300);
    // radialGradient.addColorStop(.3, '#1ff0');
    // radialGradient.addColorStop(.7, '#fff0');
    // radialGradient.addColorStop(.8, '#fff');
    // radialGradient.addColorStop(1, '#111');
    // ctx.fillStyle = radialGradient;
    ctx.fillStyle="#000"
    colorAlpha.z+= bounce(ms)
    colorAlpha.z = Math.min(colorAlpha.z,1)
    ctx.globalAlpha = colorAlpha.z
    ctx.fillRect(0, 0, w, h);
    if(colorAlpha.z>=1)colorAlpha.z=0
}

fadeOut=ms=>{
    var w=h=1024
    ctx.fillStyle="#000"
    let x = colorAlpha.z
    //colorAlpha.z = -Math.pow((2 - 1 * x - 1 * ms), 2) + Math.pow(2, 2)
    colorAlpha.z -=bounce(ms)
    colorAlpha.z = Math.max(colorAlpha.z,0)
    ctx.globalAlpha = colorAlpha.z
    if(colorAlpha.z<=0)colorAlpha.z=1
    ctx.fillRect(0, 0, w, h);
}
let sacel ={
    z:1
}
// bounce : easeout
scaleOut=ms=>{
    var w=h=1024
    ctx.fillStyle="#000"
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle="#fff"
    ctx.font = sacel.z+"px Impact"
    sacel.z+=ms*10
    ctx.fillRect(w/2,382,sacel,z)
}
GameObject = []
let maa = 0 
update=ms=>{
    drawCloud(100,135);
    //fadeOut(ms)
    blink(ms)
   // scaleOut(ms)
    maa+=ms
	GameObject.forEach(e=>{
        let pr = e.z/5
        // e.x += (e.x-centerX)*(e.wh/e.z)
        e.x += (centerX-e.x)/e.z
        e.y -= (centerY-0)/e.z
        e.z-=.5
        e.z=Math.max(e.z,0)
        rect1(ctx,e.x,e.y,pr,pr,"#0a0",1,1)
        ctx.save()
        ctx.fillStyle="#888"
        ctx.globalAlpha=1-(e.z/e.wh)
        ctx.fillRect(e.x,e.y,pr,pr)
        //ctx.fillRect(100,e.y,pr,pr)
        ctx.restore()
    })
}

let lastUpdate = performance.now();
var sy = 0
MainLoop=_=>{
    c.height=768
    c.width=1024
	ctx.clearRect(0,0,200,200)
    ctx.save()
    ctx.scale(2,2)
	const now = performance.now();
    const deltaMs = now - lastUpdate;
    const delta = deltaMs / 1000;
    lastUpdate = now;
    // sy+=1
    // for(var i=0,x=y=80;i<100;i++){
    // 	if(x>=80+(6*32)){
    //     	y+=32;
    //         x=80
    //     }
    //     //ctx.transform(1,0,1,1,0,0);
    // 	ctx.drawImage(wall,x,y-sy,32,32)
    //     x+=32
    // }
    
    ctx.restore()
    update(delta)
	requestAnimationFrame(MainLoop)
}
RandChance=(l,n)=>{
    let CollectionAppearPos = [...Array(l).keys()]
    for(var io=0;io<n;io++){
        CollectionAppearPos.splice(RandInt(CollectionAppearPos.length),1)
    }
    return CollectionAppearPos
}
// good = (speed-safeSpeed*itemSpeed) + (50/level)
// RandChance()
// chance
// bad = (th*size)/maxSpeed + (2*level)   //th 為行數  50 // 30 (最大值 50)
// RandChance(th,bad)
// 
console.log(RandChance(10,5))
MainLoop()
</script>

</body>
</html>